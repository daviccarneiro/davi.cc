---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

// 1. Buscar todos os posts da coleção 'blog'
const allPosts = await getCollection('blog');

// Opcional: Ordenar os posts pela data de publicação (do mais novo para o mais antigo)
allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title="Blog | davi.cc">
  <header class="page-header">
    <div>
      <p class="kicker" data-i18n-key="blog.header.kicker">Blog</p>
    </div>
    <p class="lead" data-i18n-key="blog.header.lead">Nada daqui tem DOI nem qualis, mas é digitado com o coração e (quase) sem IA.</p>
  </header>

  <ul class="post-list">
    {allPosts.map((post) => (
      <li class="post-item">
        <a class="post-link" href={`/blog/${post.slug}/`}>
          {post.data.heroImage && (
            <Image src={post.data.heroImage} width={260} height={160} format="webp" alt={post.data.title} class="thumb" />
          )}
          <div class="meta">
            <h3>{post.data.title}</h3>
            <p>{post.data.description}</p>
            <span class="date" data-date={post.data.pubDate.toISOString()}></span>
          </div>
        </a>
      </li>
    ))}
  </ul>
</Layout>

<style>
  .page-header {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    align-items: flex-start;
  }

  .kicker {
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    font-weight: 600;
    color: color-mix(in oklab, var(--color-text) 55%, transparent);
  }

  .page-header .lead {
    font-size: 1.05rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .post-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    gap: 1.25rem;
    margin-top: 1.5rem;
  }

  .post-item {
    background: color-mix(in oklab, var(--color-surface) 90%, transparent);
    border-radius: var(--border-radius-md);
    border: 1px solid color-mix(in oklab, var(--color-border) 60%, transparent);
    box-shadow: 0 16px 45px rgba(38, 56, 120, 0.14);
    transition: transform 200ms ease, box-shadow 200ms ease, border-color 200ms ease;
  }

  .post-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 24px 60px rgba(50, 76, 155, 0.18);
    border-color: color-mix(in oklab, var(--color-primary) 55%, transparent);
  }

  .post-link {
    display: grid;
    grid-template-columns: minmax(180px, 0.35fr) 1fr;
    gap: 1.25rem;
    padding: clamp(1rem, 1.5vw + 0.75rem, 1.5rem);
    color: inherit;
    align-items: center;
  }

  .thumb {
    width: 100%;
    height: auto;
    border-radius: var(--border-radius-sm);
    display: block;
  }

  .meta {
    display: flex;
    flex-direction: column;
    gap: 0.45rem;
  }

  .meta h3 {
    margin: 0;
    font-size: clamp(1.1rem, 0.7vw + 1rem, 1.35rem);
  }

  .meta p {
    margin: 0;
  }

  .meta .date {
    font-size: 0.85rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: color-mix(in oklab, var(--color-text) 55%, transparent);
  }

  @media (max-width: 820px) {
    .page-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .page-header .lead {
      max-width: 100%;
    }

    .post-link {
      grid-template-columns: 1fr;
    }
  }
</style>