---
// src/components/ThemeToggle.astro
import { Icon } from 'astro-icon/components';
---

<button id="theme-toggle" aria-label="Mudar tema">
  <span class="sun-icon">
    <Icon name="mdi:white-balance-sunny" />
  </span>
  <span class="moon-icon">
    <Icon name="mdi:weather-night" />
  </span>
</button>

<style>
  #theme-toggle {
    background: none;
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius);
    padding: 0.25rem 0.5rem;
    cursor: pointer;
    color: var(--color-text);
  }
  #theme-toggle:hover {
    background: var(--color-bg-hover);
  }

  /*
    Lógica de CSS para mostrar o ícone correto
    baseado na classe GLOBAL 'html.dark'
  */
  .moon-icon {
    display: none;
  }
  .sun-icon {
    display: block;
  }

  :global(html.dark) .moon-icon {
    display: block;
  }
  :global(html.dark) .sun-icon {
    display: none;
  }

  /* Ajuste de tamanho dos ícones */
  :global(svg) {
    width: 24px;
    height: 24px;
  }
</style>

<script>
  // 1. Encontrar o botão
  const toggleButton = document.getElementById('theme-toggle');

  // 2. Adicionar o "ouvinte" de clique

  toggleButton?.addEventListener('click', () => {
    // 3. Alternar a classe 'dark' no <html>
    document.documentElement.classList.toggle('dark');

    // 4. Verificar o novo estado
    const isDark = document.documentElement.classList.contains('dark');

    // 5. Salvar a preferência no localStorage
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  });
</script>