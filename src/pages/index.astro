---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

// Buscar os 3 posts mais recentes
const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<Layout title="davi.cc | Portfólio e Blog">
	<main>
		<p>
			Curiosidade é a primeira fagulha da mudança, e essa mesma fagulha fez você clicar nesse link. Parabéns por isso.
			<br/>
			Não sou ninguém que dispense apresentações, tampouco Forbes Under30 ou qualquer outra grande nomeação. Mas sou e tento ser bom no que faço.
		</p>

		<h2 style="margin-top:1.5rem;">Postagens recentes</h2>
		<ul class="recent-posts">
			{posts.map((post) => (
				<li class="post-item">
					<a href={`/blog/${post.slug}/`} class="post-link">
						{post.data.heroImage && (
							<Image src={post.data.heroImage} width={160} height={100} format="webp" alt={post.data.title} class="thumb" />
						)}
						<div class="meta">
							<h3>{post.data.title}</h3>
							<p>{post.data.description}</p>
						</div>
					</a>
				</li>
			))}
		</ul>
	</main>
</Layout>

<style>
  .recent-posts {
    list-style: none;
    padding: 0;
    margin: 1rem 0 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .post-item {
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius);
    background: var(--color-bg);
  }
  .post-link {
    display: grid;
    grid-template-columns: 160px 1fr;
    gap: 1rem;
    padding: 0.75rem;
    align-items: center;
    color: inherit;
    text-decoration: none;
  }
  .thumb {
    width: 100%;
    height: auto;
    border-radius: 6px;
    display: block;
  }
  .meta h3 {
    margin: 0 0 0.25rem;
  }
  .meta p {
    margin: 0;
    color: var(--color-text);
    opacity: 0.9;
  }

  @media (max-width: 520px) {
    .post-link { grid-template-columns: 1fr; }
    .thumb { width: 100%; }
    .meta { margin-top: 0.5rem; }
  }
</style>
