---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

// 1. Buscar todos os posts da coleção 'blog'
const allPosts = await getCollection('blog');

// Opcional: Ordenar os posts pela data de publicação (do mais novo para o mais antigo)
allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title="Blog | davi.cc">
  <main>
    <h1>Artigos e Postagens</h1>
    <p>Nada daqui tem DOI nem qualis, mas é digitado com o coração e (quase) sem IA.</p>

    <ul class="post-list">
      {allPosts.map((post) => (
        <li class="post-item">
          <a class="post-link" href={`/blog/${post.slug}/`}>
            {post.data.heroImage && (
              <Image src={post.data.heroImage} width={240} height={140} format="webp" alt={post.data.title} class="thumb" />
            )}
            <div class="meta">
              <h3>{post.data.title}</h3>
              <p>{post.data.description}</p>
            </div>
          </a>
        </li>
      ))}
    </ul>

  </main>
</Layout>

<style>
  .post-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem;}
  .post-item { border: 1px solid var(--color-border); border-radius: var(--border-radius); background: var(--color-bg); }
  .post-link { display: grid; grid-template-columns: 240px 1fr; gap: 1rem; padding: 0.75rem; align-items: center; text-decoration: none; color: inherit; }
  .thumb { width: 100%; height: auto; border-radius: 6px; display: block; }
  .meta h3 { margin: 0 0 0.25rem; }
  .meta p { margin: 0; }
  @media (max-width: 640px) {
    .post-link {
      grid-template-columns: 1fr; /* Empilha */
      grid-auto-rows: auto;
    }
    .thumb { width: 100%; }
    .meta { margin-top: 0.5rem; }
  }
</style>