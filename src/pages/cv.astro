---
import Layout from '../layouts/Layout.astro';
---

<Layout title="davi.cc | CV">
  <section class="cv">
    

    <section class="doc-embed">
      <div class="doc-frame">
        <iframe
          id="cv-embed"
          data-src-en="https://docs.google.com/document/d/1lkygIyyVerzO7K1bhU-2Q0SazfapZMll04-sidCQmJc/preview?rm=minimal"
          data-src-pt="https://docs.google.com/document/d/1lkygIyyVerzO7K1bhU-2Q0SazfapZMll04-sidCQmJc/preview?rm=minimal"
          allow="clipboard-write; encrypted-media"
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
        ></iframe>
      </div>
    </section>

    <div class="cv-actions">
      <a id="download-pdf-link" class="btn" href="/cv.pdf" download data-i18n-key="cv.download">Download as PDF</a>
      <button type="button" id="share-cv" class="btn outline" data-i18n-key="cv.share">Share this CV</button>
    </div>
  </section>

  <style>
    .cv {
      display: grid;
      gap: 1.25rem;
    }
    

    .cv-section {
      display: grid;
      gap: 0.75rem;
    }
    .cv-section h2 {
      font-size: clamp(1.2rem, 0.9vw + 1rem, 1.4rem);
    }
    .item {
      display: grid;
      gap: 0.35rem;
      border: 1px solid color-mix(in oklab, var(--color-border) 70%, transparent);
      background: color-mix(in oklab, var(--color-surface) 96%, transparent);
      border-radius: var(--border-radius-sm);
      padding: 0.9rem 1rem;
    }
    .item h3 {
      margin: 0;
      font-size: clamp(1rem, 0.7vw + 0.95rem, 1.15rem);
    }
    .item .time {
      font-size: 0.9rem;
      color: color-mix(in oklab, var(--color-text) 60%, transparent);
    }
    .item .meta-line {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 0.75rem;
    }
    .item .gpa {
      font-size: 0.9rem;
      color: color-mix(in oklab, var(--color-text) 60%, transparent);
      white-space: nowrap;
    }
    .item ul {
      margin: 0.25rem 0 0 1rem;
      padding: 0;
      display: grid;
      gap: 0.3rem;
    }

    .columns {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.75rem 1rem;
    }

    .doc-embed {
      display: grid;
    }
    .doc-frame {
      border: 1px solid color-mix(in oklab, var(--color-border) 70%, transparent);
      background: color-mix(in oklab, var(--color-surface) 96%, transparent);
      border-radius: var(--border-radius-sm);
      overflow: hidden;
      height: min(80vh, 960px);
    }
    .doc-frame iframe {
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
      background: #fff;
    }

    .cv-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      padding-top: 0.5rem;
      border-top: 1px solid color-mix(in oklab, var(--color-border) 70%, transparent);
    }
    .btn {
      appearance: none;
      border: 1px solid color-mix(in oklab, var(--color-border) 75%, transparent);
      background: color-mix(in oklab, var(--color-bg) 92%, transparent);
      color: inherit;
      padding: 0.55rem 0.9rem;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 180ms ease, border-color 180ms ease;
    }
    .btn:hover {
      background: color-mix(in oklab, var(--color-bg) 82%, transparent);
      border-color: color-mix(in oklab, var(--color-border) 88%, transparent);
    }
    .btn.outline {
      background: transparent;
    }

    /* Print styles: focus only on CV content */
    :global(@media print) {
      :global(header.mobile-header),
      :global(aside.profile-card),
      :global(footer.site-footer) {
        display: none !important;
      }
      :global(main.content) {
        border: 0 !important;
        box-shadow: none !important;
        background: #fff !important;
        padding: 0 !important;
      }
      .cv-actions {
        display: none !important;
      }
      .cv {
        gap: 0.9rem !important;
      }
      .item {
        break-inside: avoid;
      }
    }
  </style>

  <script>
    const initCvActions = () => {
      const share = document.getElementById('share-cv');
      if (share) {
        share.onclick = async () => {
          try {
            await navigator.clipboard.writeText(location.href);
            const t = (window as any).__i18n?.t || ((k: string) => k);
            const original = share.textContent || t('cv.share');
            share.textContent = t('cv.copied');
            setTimeout(() => {
              share.textContent = original;
            }, 1600);
          } catch {
            // Fallback: prompt
            const ok = confirm('Copy this URL:\n' + location.href);
            if (ok) return;
          }
        };
      }
    };
    const setCvSrc = () => {
      const frame = document.getElementById('cv-embed') as HTMLIFrameElement | null;
      if (!frame) return;
      const getLang = (window as any).__i18n?.getLang?.() || (navigator.language || 'en-US');
      const lang = String(getLang).startsWith('pt') ? 'pt-BR' : 'en-US';
      const src = lang.startsWith('pt') ? frame.getAttribute('data-src-pt') : frame.getAttribute('data-src-en');
      if (src && frame.src !== src) frame.src = src;
    };
    const initCvPage = () => {
      initCvActions();
      setCvSrc();
    };
    initCvPage();
    document.addEventListener('astro:page-load', initCvPage);
    document.addEventListener('astro:after-swap', initCvPage);
    window.addEventListener('app:language-changed', setCvSrc);
  </script>
</Layout>


